<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: admin_lessons.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: admin_lessons.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>

/** A list of candidate quiz questions waiting to be added by an admin*/
let QUESTION_CANDIDATES = [];


/** Sends a request to generate a series of questions based off of the core topics and default
 * composition of a given lesson*/
function generateQuestions(){
    if(!selected_lesson){
        console.log("You must select a lesson first!");
        return;
    }
    console.log(`Generating questions for lesson ${selected_lesson}...`);
    fetch('/generate_questions?l='+JSON.stringify([selected_lesson]),
        {method: 'GET'}).then(response => response.json()).then(response => {
        console.log("Questions:", JSON.stringify(response));
        let questions = response;
        for(let lessonId of Object.keys(questions)) {
            for (let question of Object.values(questions[lessonId].quiz)) {
                question.id = genPseudorandom();
                console.log("Question:", question);
                addCandidateQuestion(lessonId, question);
            }
        }
    });
}


/** Switches the current view to that of the lesson indicated by {@link lessonId}
 * @param lessonId {String} The id of the lesson to be entered*/
function enterLesson(lessonId){
    console.log("Entering lesson", lessonId);
    selected_lesson = lessonId;

    if(lessonId === "chat"){
        document.getElementById("lessons").style.display = "none";
        document.getElementById("mainChat").style.display = "block";
        document.getElementById("lessonTitle").innerText = "Main Chat";
        document.getElementById("outputTitle").innerText = "Chat";
        document.getElementById("saveLessonsButton").style.visibility = "hidden";
        document.getElementById("genQuestions").style.visibility = "hidden";
        return;
    }

    document.getElementById("mainChat").style.display = "none";
    document.getElementById("saveLessonsButton").style.visibility = "visible";
    document.getElementById("genQuestions").style.visibility = "visible";
    document.getElementById("genQuestions").innerText = "Generate Questions for "+lessonId;
    let lessonElem = document.getElementById("lessons");
    lessonElem.style.display = "block";
    document.getElementById("lessonTitle").innerText = "Lesson "+lessonId;

    lessonElem.innerHTML = "";
    lessonElem.appendChild(formatQuestions(lessonId, lessons[lessonId].quiz, false, onQuestionAdd));
}


/** Saves the current lesson configuration to disk to be retrieved later*/
function saveLessons(){

    if(!selected_lesson){
        console.log("You must select a lesson first!");
        return;
    }

    console.log("Saving lessons as", lessons);

    fetch('/save_lessons', {
        method: 'POST',
        headers: {'Accept': 'application/json', 'Content-Type': 'application/json'},
        body: JSON.stringify({'updatedLessons': lessons})
    }).then(response => response.json()).then(response => {
        console.log(JSON.stringify(response));
        console.log("Success:", response.success);
    });
}


/** Requests the recorded grades from the backend and downloads them as a file*/
function requestGrades(){
    console.log(`Requesting grades...`);
    fetch('/admin/grades', {method: 'GET'}).then(response => response.json()).then(response => {
        // Create element with &lt;a> tag
        const link = document.createElement("a");
        const file = new Blob([response.grades], { type: 'text/plain' });
        link.href = URL.createObjectURL(file);
        link.download = "grades.csv";

        link.click();
        URL.revokeObjectURL(link.href);
    });
}


/** Adds a question to the list of candidate questions and to the sidebar.  These may be added to a quiz through admin oversight
 * @param lessonId {String} The id of the lesson to add approved questions to
 * @param question {Object} Dictionary containing the question information*/
function addCandidateQuestion(lessonId, question){
    let sidebarRight = document.getElementById("sidebarRight");
    let elem = document.createElement("DIV");
    elem.id = `candidate${question.id}`;
    elem.classList.add("navElement");
    elem.style.marginBottom = "10px";
    elem.innerText = JSON.stringify(question);

    let addButton = document.createElement("BUTTON");
    addButton.id = `add${question.id}`;
    addButton.className = "questionEditButton";
    addButton.innerText = "&lt;--";
    addButton.style.backgroundColor = "green";
    addButton.onclick = () => {
        let lessonElem = document.getElementById(`lessonForm${lessonId}`);
        formatQuestions(lessonId, [question], false, lessonElem);
        lessons[lessonId].quiz.push(question);
        elem.remove();
        addButton.remove();
    };

    QUESTION_CANDIDATES.push(question);
    sidebarRight.appendChild(addButton);
    sidebarRight.appendChild(elem);
}


/** Removes the quiz with an id of {@link quesId} from the lesson with the id {@link lessonId} and returns the removed element
 * @param lessonId {String} The id of the lesson to remove the question from
 * @param quesId {String} The id of the quiz question to remove
 * @return {HTMLElement | null} The removed question element*/
function removeQuizQuestion(lessonId, quesId) {
    let found = null;
    console.log("Removing quiz", quesId, "from lesson", lessonId);
    for(let i=0; i&lt;lessons[lessonId].quiz.length; i++){
        if(lessons[lessonId].quiz[i].id === quesId) {
            found = lessons[lessonId].quiz[i];
            QUESTION_CANDIDATES.push(lessons[lessonId].quiz[i]);
            lessons[lessonId].quiz.splice(i, 1);
        }
    }
    if(found) {
        document.getElementById(`question${quesId}`).remove();
        document.getElementById(`delete${quesId}`).remove();
        return found;
    }
}


/** Called when a question is added to a lesson.  Adds an extra delete button that removes an added
 * question and turns it back into a candidate
 * @param lessonId {String} The id of the lesson the question is being added to
 * @param quesId {String} The id of the question
 * @param quizDiv {HTMLElement} The quiz element that the question is being added to*/
function onQuestionAdd(lessonId, quesId, quizDiv){
    let delButton = document.createElement("BUTTON");
    delButton.id = `delete${quesId}`;
    delButton.className = "questionEditButton";
    delButton.innerText = "-->";
    delButton.style.backgroundColor = "red";
    delButton.onclick = () => {
        let removed = removeQuizQuestion(lessonId, quesId);
        addCandidateQuestion(lessonId, removed);
    };

    quizDiv.appendChild(delButton);
}


window.onload = () => {
    enterLesson('chat');
    let sidebarLeft = document.getElementById("sidebarLeft");
    sidebarLeft.innerHTML = `&lt;div class="navElement" onclick="enterLesson('chat');">Main Chat&lt;/div>`;
    setAdmin();
    loadLessons(enterLesson);
};</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#QUESTION_CANDIDATES">QUESTION_CANDIDATES</a></li><li><a href="global.html#RCS_ID">RCS_ID</a></li><li><a href="global.html#addCandidateQuestion">addCandidateQuestion</a></li><li><a href="global.html#addOutput">addOutput</a></li><li><a href="global.html#chat_history">chat_history</a></li><li><a href="global.html#enterLesson">enterLesson</a></li><li><a href="global.html#formatQuestions">formatQuestions</a></li><li><a href="global.html#genPseudorandom">genPseudorandom</a></li><li><a href="global.html#generateQuestions">generateQuestions</a></li><li><a href="global.html#lessons">lessons</a></li><li><a href="global.html#loadChat">loadChat</a></li><li><a href="global.html#loadLessons">loadLessons</a></li><li><a href="global.html#onQuestionAdd">onQuestionAdd</a></li><li><a href="global.html#removeQuizQuestion">removeQuizQuestion</a></li><li><a href="global.html#requestGrades">requestGrades</a></li><li><a href="global.html#saveLessons">saveLessons</a></li><li><a href="global.html#selected_lesson">selected_lesson</a></li><li><a href="global.html#sendChat">sendChat</a></li><li><a href="global.html#sendQuiz">sendQuiz</a></li><li><a href="global.html#setAdmin">setAdmin</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.2</a> on Sat Apr 15 2023 13:27:28 GMT-0400 (Eastern Daylight Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
